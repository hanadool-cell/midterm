<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Bouquet - ë‚˜ë§Œì˜ ê½ƒë‹¤ë°œ</title>

    <link rel="stylesheet" href="https://use.typekit.net/bno4gef.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    

    <style>
        
        
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body {
            background-image: url('gridback.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            height: 100vh;
            margin: 0;
            font-family: "pretendard", sans-serif;
            font-weight: 500;
            font-style: normal;
            overflow: hidden;
            position: relative; /* ìì‹ absolute ìš”ì†Œë“¤ì˜ ê¸°ì¤€ì  */
            /* display: flex; justify-content: center; align-items: center; ì œê±° */
        }

        body::before { display: none; }
        body::after {
            content: "";
            position: fixed; /* í™”ë©´ ì „ì²´ ê³ ì • */
            bottom: 0; /* í•˜ë‹¨ ì •ë ¬ */
            left: 0;
            width: 100%;
            height: 30vh; /* í™”ë©´ ë†’ì´ì˜ 40%ë§Œí¼ ê·¸ë¼ë°ì´ì…˜ ì ìš© (ì¡°ì ˆ ê°€ëŠ¥) */
            /* ì•„ë˜ì—ì„œ ìœ„ë¡œ (ì§„í•œ ìƒ‰ -> íˆ¬ëª…) */
            background:  linear-gradient(to top, #cdff453e, rgba(94, 255, 252, 0.13),rgba(176, 255, 65, 0));
            z-index: -1; /* gridback.jpgë³´ë‹¤ëŠ” ìœ„, ì½˜í…ì¸ ë³´ë‹¤ëŠ” ì•„ë˜ */
            pointer-events: none; /* í´ë¦­ ë°©í•´ ê¸ˆì§€ */
        }

        /* --- 1. í—¤ë” ì˜ì—­ (ì¢Œì¸¡ ìƒë‹¨ ê³ ì •) --- */
        #header-area {
            background-color: transparent;
            width: 45vw; /* ì¢Œì¸¡ ì˜ì—­ ë„ˆë¹„ */
            height: 100vh; /* í™”ë©´ ì „ì²´ ë†’ì´ ìœ ì§€ */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* ìœ„ì—ì„œë¶€í„° ë°°ì¹˜ */
            align-items: flex-start; /* ì™¼ìª½ ì •ë ¬ */
            position: absolute; /* **[ìˆ˜ì •]** ì ˆëŒ€ ìœ„ì¹˜ */
            top: 0; /* **[ìˆ˜ì •]** ìƒë‹¨ ê³ ì • */
            left: 0; /* **[ìˆ˜ì •]** ì¢Œì¸¡ ê³ ì • */
            padding: 3vh 3.5vw; /* íŒ¨ë”© */
            text-align: left; /* ì™¼ìª½ ì •ë ¬ */
            z-index: 10;
        }

       
         #header-area::after {
             display: none;
         }

        #header-area h1 {
            font-size: 3vw;
            color: white;
            margin-top: 5vh;
            margin-bottom: 1.5vw;
            position: relative;
            z-index: 2;
            font-weight: 400;
            letter-spacing: -0.01vw;
            line-height: 1.1;
            text-shadow: #00000043 0 0 0.5vw;
        }

        #header-area h1 .special-font { /* (LOVE) */
            font-family: "argent-pixel-cf", sans-serif;
            font-weight: 500;
            font-style: italic;
            letter-spacing: -0.2vw;
            font-size: 3.5vw;
            background: linear-gradient(to right, #cdff45, #5efffc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: none;
        }
        #header-area h1 .special-font2 { /* ê´„í˜¸ */
             font-family: "pretendard", sans-serif;
             font-weight: 300;
             font-style: italic;
             letter-spacing: 0vw;
             font-size: 3.2vw;
        }

        #header-area p {
            font-size: 1.3vw;
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 4vh 0;
            position: relative;
            z-index: 11;
            opacity: 0.8;
            font-weight: 300;
            letter-spacing: 0.7px;
        }
        /* ì„¤ëª… ë°•ìŠ¤ */
        #description-box {
            width: 36%; /* í—¤ë” íŒ¨ë”© ì œì™¸í•œ ë¶€ëª¨ ë„ˆë¹„ ê¸°ì¤€ */
            height: 39%;
            background-color: rgba(0, 0, 0, 0.2); /* ë°˜íˆ¬ëª… ë°°ê²½ */
            border: 1px solid rgba(255, 255, 255, 0.1); /* ì–‡ì€ í…Œë‘ë¦¬ */
            z-index: 11;
            top: 32%;
            position: absolute;
            border: #cdff45 1px solid;
            left: 3.5%;
        }

        #description-box h1 {
            font-family: "argent-pixel-cf", sans-serif;
            font-weight: 500;
            font-style: normal;
            letter-spacing: -0.2vw;
            font-size: 2.4vw;
            background: #cdff45;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: none;
            text-align: center;
            
            
        }
        #description-box p {
            font-family: "pretendard", sans-serif; /* Pretendard í°íŠ¸ ì ìš© */
            font-size: 1.2vw;
            font-weight: 300;
            line-height: 1.6;
            margin: 0;
            opacity: 1;
            color:#cdff45; /* p íƒœê·¸ ìŠ¤íƒ€ì¼ ìƒì†/ì¬ì •ì˜ */
            text-align: left;
            margin-top: 2.6vw;
            margin-left: 2vw; /* ì¢Œì¸¡ ì •ë ¬ */
            letter-spacing: 1.4px; /* ìê°„ ì¡°ì • */
            line-height: 1.7;
            display: flex;
        }

        /* --- ê½ƒë‹¤ë°œ ì»¨í…Œì´ë„ˆ (ìš°ì¸¡ ì¤‘ì•™ ê³ ì •) --- */
       #bouquet-container {
            width: 55vw; /* ìš°ì¸¡ ì˜ì—­ ë„ˆë¹„ */
            height: 90vh; /* ì´ì „ ë†’ì´ ìœ ì§€ */
            position: absolute; /* ì ˆëŒ€ ìœ„ì¹˜ */
            right: 0; /* ì˜¤ë¥¸ìª½ì— ë¶™ì„ */
            top: 50%; /* ì„¸ë¡œ ì¤‘ì•™ ì‹œì‘ì  */
            transform: translateY(-50%); /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
            background-color: transparent; /* **[ìˆ˜ì •]** ì²˜ìŒì—ëŠ” íˆ¬ëª…í•˜ê²Œ */
            
            overflow: hidden;
            z-index: 5;
            /* ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ transition */
            transition: transform 1.6s ease-in-out, background-color 0.8s ease-in-out, width 1.6s ease-in-out, height 1.6s ease-in-out, left 1.6s ease-in-out, right 1.6s ease-in-out, top 1.6s ease-in-out;
        }

       /* ê½ƒë‹¤ë°œ ë°°ê²½ í¬ì¥ì§€ (ì´ì „ ê°’ ìœ ì§€) */
        #bouquet-back {
            position: absolute;
            bottom: 1vh;
            left: 45%;
            transform: translateX(-50%);
            width: auto; /* ì´ì „ ê°’ ìœ ì§€ */
            height: 98%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }

        /* ê½ƒ ë°°ì¹˜ ì˜ì—­ (ì´ì „ ê°’ ìœ ì§€) */
        #flower-area {
            position: absolute;
            top: 6%;
            left: 7%;
            width: 74%; /* ì´ì „ ê°’ ìœ ì§€ (í•„ìš”ì‹œ ì¡°ì •) */
            height: 60%; /* ì´ì „ ê°’ ìœ ì§€ */
            z-index: 2;
            pointer-events: none;
            clip-path: polygon(0% 0%, 100% 0%, 68% 100%,32% 100%);
            
            
            
        }

        /* ê½ƒë‹¤ë°œ ì „ê²½ í¬ì¥ì§€ (ì´ì „ ê°’ ìœ ì§€) */
        #bouquet-front {
            position: absolute;
            bottom: 1vh;
            left: 45%;
            transform: translateX(-50%);
            width: auto; /* ì´ì „ ê°’ ìœ ì§€ */
            height: 70%;
            z-index: 3;
            pointer-events: none;
            overflow: hidden;
        }

        /* ê°œë³„ ê½ƒ ì´ë¯¸ì§€ */
        .draggable-flower {
            position: absolute;
            width: 10vw; /* **[ìˆ˜ì •]** ì´ì „ ê°’ ìœ ì§€ (í˜¹ì€ 11vw ë“± ì•½ê°„ í‚¤ìš¸ ìˆ˜ ìˆìŒ) */
            height: auto;
            cursor: grab;
            z-index: 2;
            transition: transform 0.2s ease-out, box-shadow 0.1s ease-out;
            user-select: none;
            -webkit-user-drag: none;
            pointer-events: auto;
            filter: drop-shadow(5px 5px 5px rgba(0, 0, 0, 0.6));
        }

        .draggable-flower.dragging {
            cursor: grabbing;
            z-index: 10;
        }

       
        /* Typekit ë¡œë”© */
        .wf-loading body { visibility: hidden; }
        .wf-active body { visibility: visible; }



     

         /* --- ë²„íŠ¼ ì˜ì—­ (ì¢Œì¸¡ í•˜ë‹¨) --- */
        #button-area {
            position: absolute; /* ì ˆëŒ€ ìœ„ì¹˜ */
            left: 3.5vw; /* í—¤ë” ì¢Œì¸¡ íŒ¨ë”©ê³¼ ë§ì¶¤ */
            bottom: 18vh;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* ì™¼ìª½ ì •ë ¬ */
        }

        #next-button {
            padding: 1vw 5vw;
            font-size: 2vw;
            font-family: "argent-pixel-cf", sans-serif;
            font-weight: 900;
            font-style: regular;
            color: #cdff45;
            background: rgba(0, 0, 0, 0.434);
            border: #cdff45 1px solid ; /* **[ìˆ˜ì •]** í…Œë‘ë¦¬ ìƒ‰ìƒ ëª…ì‹œ */
            cursor: pointer;
            transition: background 0.3s, color 0.3s; /* **[ìˆ˜ì •]** color ì „í™˜ ì¶”ê°€ */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        #next-button:hover {
             background: #cdff45; /* **[ìˆ˜ì •]** í˜¸ë²„ ë°°ê²½ìƒ‰ ë³€ê²½ */
             color: rgb(0, 0, 0); /* **[ì¶”ê°€]** í˜¸ë²„ ì‹œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
        }
        /* --- **[ì•„ë˜ ì½”ë“œ ë¸”ë¡ ì „ì²´ ì¶”ê°€]** --- */
        
        /* --- ì™„ì„± ë·° ìŠ¤íƒ€ì¼ --- */

        /* bodyì— complete-view í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆì„ ë•Œ */
        body.complete-view #header-area {
            width: 100vw; /* ì „ì²´ ë„ˆë¹„ */
            height: 35vh; /* **[ìˆ˜ì •]** ìƒë‹¨ 35% ë†’ì´ (í…ìŠ¤íŠ¸/ë²„íŠ¼ ê³µê°„) */
            justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            align-items: center; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
            text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            padding: 0;
            top: 0;
            left: 50;
            z-index: 10; /* ê½ƒë‹¤ë°œë³´ë‹¤ ë‚®ê²Œ */
        }
        body.complete-view #header-area h1,
        body.complete-view #header-area p,
        body.complete-view #description-box,
        body.complete-view #button-area {
            opacity: 0;
            pointer-events: none; /* í´ë¦­ ë°©ì§€ */
        }

        /* ê½ƒë‹¤ë°œ ì»¨í…Œì´ë„ˆ ì¤‘ì•™ ì´ë™ ë° ìŠ¤ì¼€ì¼ */
        body.complete-view #bouquet-container {
            width: 55vw; /* ë„ˆë¹„ ìœ ì§€ */
            height: 90vh; /* ë†’ì´ ìœ ì§€ */
            left: 52%; /* ê°€ë¡œ ì¤‘ì•™ */
            top: 54%; /* ì„¸ë¡œ ì¤‘ì•™ */
            right: auto; /* right: 0 ì†ì„± ë¬´íš¨í™” */
            transform: translate(-50%, -50%) scale(0.65); /* **[ìˆ˜ì •]** ì¤‘ì•™ ì •ë ¬ ë° ì¶•ì†Œ ë¹„ìœ¨ì„ 0.65ë¡œ ì•½ê°„ ë” ì¤„ì„ */
            z-index: 20; /* í—¤ë”ë³´ë‹¤ ì•ìœ¼ë¡œ */
            background-color: rgba(0, 0, 0, 0); /* **[ì¶”ê°€]** ì™„ì„± ì‹œ ë°°ê²½ìƒ‰ ë‹¤ì‹œ í‘œì‹œ */
            
        }

        /* ì™„ì„± ì‹œ ê½ƒ ì˜ì—­ í…Œë‘ë¦¬/í´ë¦½íŒ¨ìŠ¤ ì œê±° */
        body.complete-view #flower-area {
            border: none; /* **[ìˆ˜ì •]** í…Œë‘ë¦¬ ì—†ìŒ */
            clip-path: none; /* **[ìˆ˜ì •]** í´ë¦½íŒ¨ìŠ¤ ì—†ìŒ */
        }

        /* ì™„ì„± ë·° í…ìŠ¤íŠ¸ ì˜ì—­ */
        #complete-text-area {
           position: absolute;
            top: 5vh; /* í•˜ë‹¨ ì—¬ìœ  */
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
            opacity: 0;
            transition: opacity 0.5s ease-out 0.5s; /* 0.5ì´ˆ ë’¤ì— ë‚˜íƒ€ë‚¨ */
            
            display: flex; /* **[ìˆ˜ì •]** flexë¡œ ë³€ê²½ */
            text-align: center;
        }
        #complete-text-area h1 {
            font-size: 3vw;
            color: white;
            margin-top: 5vh;
            margin-bottom: 1vw;
            position: relative;
            z-index: 2;
            font-weight: 400;
            letter-spacing: -0.01vw;
            line-height: 1.1;
            text-shadow: #00000043 0 0 0.5vw;
        }
        #complete-text-area h1 .special-font { /* (LOVE) */
            font-family: "argent-pixel-cf", sans-serif;
            font-weight: 500;
            font-style: italic;
            letter-spacing: -0.2vw;
            font-size: 3.5vw;
            background: linear-gradient(to right, #cdff45, #5efffc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: none;
        }
        #complete-text-area h1 .special-font2 { /* ê´„í˜¸ */
             font-family: "pretendard", sans-serif;
             font-weight: 300;
             font-style: italic;
             letter-spacing: 0vw;
             font-size: 3.2vw;
         }
        #complete-text-area p {
            font-size: 1.2vw; /* í—¤ë” pì™€ ë¹„ìŠ·í•˜ê²Œ */
            color: rgba(255, 255, 255, 0.8);
            margin-top: 1.5vh;
            font-weight: 300;
            letter-spacing: 0.7px;
        }
        
        /* ì™„ì„± ë·° ë²„íŠ¼ ì˜ì—­ */
        #complete-button-area {
            position: absolute;
            bottom: 6vh; /* í•˜ë‹¨ ì—¬ìœ  */
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
            opacity: 0;
            transition: opacity 0.5s ease-out 0.5s; /* 0.5ì´ˆ ë’¤ì— ë‚˜íƒ€ë‚¨ */
            gap: 2vw;
            display: flex; /* **[ìˆ˜ì •]** flexë¡œ ë³€ê²½ */
        }

        /* ê¸°ì¡´ .action-button ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš© */
        #complete-button-area .action-button {
            padding: 1vw 5vw;
            font-size: 2vw;
            font-family: "argent-pixel-cf", sans-serif;
            font-weight: 900;
            font-style: regular;
            color: #cdff45;
            background: rgba(0, 0, 0, 0.434);
            border: #cdff45 1px solid ; /* **[ìˆ˜ì •]** í…Œë‘ë¦¬ ìƒ‰ìƒ ëª…ì‹œ */
            cursor: pointer;
            transition: background 0.3s, color 0.3s; /* **[ìˆ˜ì •]** color ì „í™˜ ì¶”ê°€ */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            
        }
        #complete-button-area .action-button:hover {
             background: #cdff45;
             color: rgb(0, 0, 0);
        }
      
    </style>
    
</head>
<body>
    <div id="header-area">
        <h1>MOVE THE FLOWERS IN YOUR<span class="special-font2">( </span><span class="special-font">STLYE</span><span class="special-font2">) </span></h1>
        <p>ê½ƒì„ ë“œë˜ê·¸í•˜ê³  ì›í•˜ëŠ” ë°°ì¹˜ë¡œ ì˜®ê²¨, ê½ƒë‹¤ë°œì„ ì™„ì„±í•´ë³´ì„¸ìš”.</p>
        </div>
        <div id="description-box">
            <h1>GUIDE</h1>
            <p>1. í•œ ê½ƒë‹¤ë°œì€ ì´ 7ê°œì˜ ê½ƒìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.<br><br> 2. ê½ƒì„ ë”ë¸” í´ë¦­í•˜ë©´ ì¢Œìš°ë¥¼ ë°˜ì „ ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br> 3. ê½ƒì„ ë“œë˜ê·¸í•˜ê³  ìˆëŠ” ìƒíƒœì—ì„œ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼  
             ëˆ„ë¥´ë©´ í•´ë‹¹ <br> ê½ƒì„ ë’¤ë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div id="complete-text-area">
        <h1><span class="special-font2">( </span><span class="special-font">BOUQUET</span><span class="special-font2"> ) </span>IS COMPLETE!</h1>
        <p>ê½ƒë‹¤ë°œì„ ì™„ì„±í–ˆì–´ìš”! ìƒëŒ€ì—ê²Œ ì „ë‹¬í•˜ëŸ¬ ê°€ë³¼ê¹Œìš”?</p>
    </div>

    <div id="complete-button-area">
        <button id="modify-button" class="action-button">MODIFY</button>
        <button id="write-letter-button" class="action-button">WRITE LETTER</button>
    </div>
    <div id="bouquet-container">
        <img id="bouquet-back" src="bouquetbb.png" alt="ê½ƒë‹¤ë°œ ë°°ê²½ í¬ì¥ì§€">
        <div id="flower-area">
            </div>
        <img id="bouquet-front" src="bouquetff.png" alt="ê½ƒë‹¤ë°œ ì „ê²½ í¬ì¥ì§€">

    


       
    </div>
      <div id="button-area">
        <button id="next-button">NEXT</button> </div>

    <script>
      (function(d) {
        var config = {
          kitId: 'bno4gef',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script>

  <script>
       document.addEventListener('DOMContentLoaded', () => {
            const bouquetContainer = document.getElementById('bouquet-container');
            const flowerPlacementArea = document.getElementById('flower-area');
            const totalFlowersToGenerate = 7; 

            // ë²„íŠ¼ ë° UI ìš”ì†Œ ì°¸ì¡°
            const nextButton = document.getElementById('next-button');
            const headerArea = document.getElementById('header-area');
            const descriptionBox = document.getElementById('description-box');
            const buttonArea = document.getElementById('button-area');
            const completeTextArea = document.getElementById('complete-text-area');
            const completeButtonArea = document.getElementById('complete-button-area');
            const modifyButton = document.getElementById('modify-button');
            const writeLetterButton = document.getElementById('write-letter-button'); // ìº¡ì²˜ ë° ì´ë™ ë²„íŠ¼


            let flowerElements = [];
            let highestFlowerZIndex = 2; 

            // 1. ì´ì „ í˜ì´ì§€ ê½ƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¡œì§ ìœ ì§€)
            const urlParams = new URLSearchParams(window.location.search);
            const selectedFlowerNamesString = urlParams.get('flowers');
            let availableFlowers = [];
            if (selectedFlowerNamesString) {
                const flowerNames = selectedFlowerNamesString.split(',');
                const allFlowerData = {
                    "Iris": { imgSrc: "love/iris.png", name: "Iris" },
                    "Lily": { imgSrc: "love/lily.png", name: "Lily" },
                    "Myosotis": { imgSrc: "love/Myosotis.png", name: "Myosotis" },
                    "Rose": { imgSrc: "love/rose.png", name: "Rose" },
                    "Peony": { imgSrc: "Celebration/Peony.png", name: "Peony" },
                    "BirdofParadise": { imgSrc: "Celebration/BirdofParadise.png", name: "BirdofParadise" },
                    "PhalaenopsisOrchid": { imgSrc: "Celebration/PhalaenopsisOrchid.png", name: "PhalaenopsisOrchid" },
                    "Gerbera": { imgSrc: "Celebration/Gerbera.png", name: "Gerbera" },
                    "daisy": { imgSrc: "Gratitude/daisy.png", name: "daisy" },
                    "SweetPea": { imgSrc: "Gratitude/SweetPea.png", name: "SweetPea" },
                    "Freesia": { imgSrc: "Gratitude/Freesia.png", name: "Freesia" },
                    "Hydrangea": { imgSrc: "Gratitude/Hydrangea.png", name: "Hydrangea" },
                    "Anemone": { imgSrc: "Cheer/Anemone.png", name: "Anemone" },
                    "Gomphrena": { imgSrc: "Cheer/Gomphrena.png", name: "Gomphrena" },
                    "Sunflower": { imgSrc: "Cheer/Sunflower.png", name: "Sunflower" },
                    "Cyclamen": { imgSrc: "Cheer/Cyclamen.png", name: "Cyclamen" }
                };
                availableFlowers = flowerNames.map(name => allFlowerData[name.trim()]).filter(Boolean);
            }
            if (availableFlowers.length === 0) {
                console.warn("ì„ íƒëœ ê½ƒì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ê½ƒìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.");
                availableFlowers.push({ imgSrc: "love/rose.png", name: "Rose" });
            }

            // 2. ê½ƒ ëœë¤ ë°°ì¹˜ í•¨ìˆ˜ (ë¡œì§ ìœ ì§€)
            function generateRandomFlowers() {
                flowerElements.forEach(flower => flower.remove());
                flowerElements = [];
                highestFlowerZIndex = 2; 

                if (!flowerPlacementArea) { return; }

                setTimeout(() => {
                    const areaRect = flowerPlacementArea.getBoundingClientRect();
                    const areaWidth = areaRect.width;
                    const areaHeight = areaRect.height;

                    if (areaWidth <= 0 || areaHeight <= 0) { return; }

                    const flowerWidthVW = 11; 

                    for (let i = 0; i < totalFlowersToGenerate; i++) {
                        const randomFlowerData = availableFlowers[Math.floor(Math.random() * availableFlowers.length)];
                        const flowerDiv = document.createElement('img');
                        flowerDiv.src = randomFlowerData.imgSrc;
                        flowerDiv.alt = randomFlowerData.name;
                        flowerDiv.classList.add('draggable-flower');

                        flowerDiv.style.width = `${flowerWidthVW}vw`;

                        const tempDiv = document.createElement('div');
                        tempDiv.style.position = 'absolute'; tempDiv.style.visibility = 'hidden';
                        tempDiv.style.width = `${flowerWidthVW}vw`;
                        document.body.appendChild(tempDiv);
                        const flowerWidth = tempDiv.offsetWidth; document.body.removeChild(tempDiv);
                        const flowerHeight = flowerWidth;

                        const randomTranslateX = (areaWidth / 2 - flowerWidth / 2) + (Math.random() - 0.5) * (areaWidth * 0.4);
                        const randomTranslateY = Math.pow(Math.random(), 1.5) * Math.max(0, (areaHeight / 3) - flowerHeight);
                        const finalX = Math.max(0, Math.min(randomTranslateX, areaWidth - flowerWidth));
                        const finalY = Math.max(0, Math.min(randomTranslateY, areaHeight - flowerHeight));
                        const initialRotate = 0;
                        const initialScaleX = 1;

                        flowerDiv.style.transform = `translate(${finalX}px, ${finalY}px) rotate(${initialRotate}deg) scaleX(${initialScaleX})`;
                        flowerDiv.dataset.translateX = finalX;
                        flowerDiv.dataset.translateY = finalY;
                        flowerDiv.dataset.rotate = initialRotate;
                        flowerDiv.dataset.scaleX = initialScaleX;

                        flowerPlacementArea.appendChild(flowerDiv);
                        flowerElements.push(flowerDiv);
                    }
                    attachDragEvents();
                }, 250);
            }

            // 3. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ (ë¡œì§ ìœ ì§€)
            let activeItem = null;
            let initialClientX, initialClientY;
            let initialTranslateX, initialTranslateY;
            let currentRotate;
            let currentScaleX;

            function attachDragEvents() {
                flowerElements.forEach(item => {
                    item.addEventListener('touchstart', dragStart, { passive: false });
                    item.addEventListener('touchend', dragEnd, false);
                    item.addEventListener('touchmove', drag, { passive: false });
                    item.addEventListener('mousedown', dragStart, false);
                    item.addEventListener('dblclick', flipItem);
                });
                document.addEventListener('mousemove', drag, false);
                document.addEventListener('mouseup', dragEnd, false);
            }

            function handleKeyDown(e) {
                if (activeItem && (e.key === ' ' || e.code === 'Space')) {
                    e.preventDefault(); 
                    activeItem.style.zIndex = 2; 
                    console.log('Sent to back (z-index: 2)');
                }
            }

            function flipItem(e) { 
                const targetItem = e.target;
                if (!targetItem.classList.contains('draggable-flower') || activeItem) { return; }

                let currentScale = parseFloat(targetItem.dataset.scaleX || 1);
                const currentTranslateX = parseFloat(targetItem.dataset.translateX || 0);
                const currentTranslateY = parseFloat(targetItem.dataset.translateY || 0);
                const currentRotation = parseFloat(targetItem.dataset.rotate || 0);

                currentScale *= -1;

                targetItem.dataset.scaleX = currentScale;
                targetItem.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) rotate(${currentRotation}deg) scaleX(${currentScale})`;
            }

            function dragStart(e) { 
                if (e.target.classList.contains('draggable-flower')) {
                    activeItem = e.target;
                    activeItem.classList.add('dragging');
                    activeItem.style.zIndex = 100; 

                    initialTranslateX = parseFloat(activeItem.dataset.translateX || 0);
                    initialTranslateY = parseFloat(activeItem.dataset.translateY || 0);
                    currentRotate = parseFloat(activeItem.dataset.rotate || 0);
                    currentScaleX = parseFloat(activeItem.dataset.scaleX || 1);

                    if (e.type === "touchstart") {
                        initialClientX = e.touches[0].clientX;
                        initialClientY = e.touches[0].clientY;
                    } else {
                        initialClientX = e.clientX;
                        initialClientY = e.clientY;
                    }
                    e.preventDefault();

                    document.addEventListener('keydown', handleKeyDown);
                }
            }

            function drag(e) { 
                if (!activeItem) return;
                e.preventDefault();

                let currentClientX, currentClientY;
                if (e.type === "touchmove") {
                    currentClientX = e.touches[0].clientX;
                    currentClientY = e.touches[0].clientY;
                } else {
                    currentClientX = e.clientX;
                    currentClientY = e.clientY;
                }

                const dx = currentClientX - initialClientX;
                const dy = currentClientY - initialClientY;
                let newTranslateX = initialTranslateX + dx;
                let newTranslateY = initialTranslateY + dy;

                // ë“œë˜ê·¸ ì œí•œ ë¡œì§
                 const areaRect = flowerPlacementArea.getBoundingClientRect();
                 const itemRect = activeItem.getBoundingClientRect();
                 const itemWidth = itemRect.width;
                 const itemHeight = itemRect.height;
                 const minX = 0;
                 const maxX = areaRect.width - itemWidth;
                 const minY = 0;
                 const maxY = areaRect.height - itemHeight;
                 newTranslateX = Math.max(minX, Math.min(newTranslateX, maxX));
                 newTranslateY = Math.max(minY, Math.min(newTranslateY, maxY));

                activeItem.style.transform = `translate(${newTranslateX}px, ${newTranslateY}px) rotate(${currentRotate}deg) scaleX(${currentScaleX})`;
            }

            function dragEnd(e) { 
                document.removeEventListener('keydown', handleKeyDown);

                if (!activeItem) return;

                activeItem.classList.remove('dragging');

                if (activeItem.style.zIndex != 2) { 
                    highestFlowerZIndex++;
                    activeItem.style.zIndex = highestFlowerZIndex;
                }

                const currentTransform = activeItem.style.transform;
                const transformMatch = currentTransform.match(/translate\(([-.\d]+)px,\s*([-.\d]+)px\)/);
                if(transformMatch) {
                     activeItem.dataset.translateX = transformMatch[1];
                     activeItem.dataset.translateY = transformMatch[2];
                } else {
                     console.warn("Could not parse translate values.");
                     const clientX = e.type === "touchend" ? (e.changedTouches[0] ? e.changedTouches[0].clientX : initialClientX) : e.clientX;
                     const clientY = e.type === "touchend" ? (e.changedTouches[0] ? e.changedTouches[0].clientY : initialClientY) : e.clientY;
                     activeItem.dataset.translateX = initialTranslateX + (clientX - initialClientX);
                     activeItem.dataset.translateY = initialTranslateY + (clientY - initialClientY);
                }

                activeItem = null;
            }

            
            // 4. NEXT ë²„íŠ¼ ê¸°ëŠ¥ (ì• ë‹ˆë©”ì´ì…˜ ë° ë·° ì „í™˜)
            if (nextButton) {
                nextButton.addEventListener('click', () => {
                    
                    // 1. ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥ (sessionStorage)
                    const bouquetData = flowerElements.map(flowerEl => {
                        return {
                            imgSrc: flowerEl.getAttribute('src'),
                            alt: flowerEl.getAttribute('alt'),
                            width: flowerEl.style.width,
                            zIndex: flowerEl.style.zIndex || 2,
                            transform: flowerEl.style.transform,
                            translateX: flowerEl.dataset.translateX,
                            translateY: flowerEl.dataset.translateY,
                            rotate: flowerEl.dataset.rotate,
                            scaleX: flowerEl.dataset.scaleX
                        };
                    });

                    try {
                        sessionStorage.setItem('completedBouquetData', JSON.stringify(bouquetData));
                        console.log("ê½ƒë‹¤ë°œ ë°ì´í„° ì €ì¥ë¨.");
                    } catch (error) {
                        console.error("ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:", error);
                        alert("ê½ƒë‹¤ë°œ ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                        return; // ì €ì¥ ì‹¤íŒ¨ ì‹œ ì¤‘ë‹¨
                    }

                    // 2. bodyì— 'complete-view' í´ë˜ìŠ¤ ì¶”ê°€ (CSS ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘)
                    document.body.classList.add('complete-view');
                    
                    // 3. ê¸°ì¡´ UI ìˆ¨ê¸°ê¸°
                    headerArea.style.opacity = '0';
                    descriptionBox.style.opacity = '0';
                    buttonArea.style.opacity = '0';

                    // 4. ìƒˆë¡œìš´ UI í‘œì‹œ
                    completeTextArea.style.display = 'block';
                    completeButtonArea.style.display = 'flex'; // flexë¡œ ì„¤ì •
                    setTimeout(() => { // ì ì‹œ í›„ fade-in
                        completeTextArea.style.opacity = '1';
                        completeButtonArea.style.opacity = '1';
                    }, 500); // 0.5ì´ˆ ë’¤ (CSS transition ì‹œê°„)

                    // 5. ë“œë˜ê·¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”
                    flowerElements.forEach(item => {
                        item.style.pointerEvents = 'none';
                        item.style.cursor = 'default';
                    });
                });
            } else {
                console.error("#next-button ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }

            // 5. ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ ê¸°ëŠ¥ (ë¡œì§ ìœ ì§€)
            if(modifyButton) {
                modifyButton.addEventListener('click', () => {
                    // 1. bodyì—ì„œ 'complete-view' í´ë˜ìŠ¤ ì œê±° (ì• ë‹ˆë©”ì´ì…˜ ë³µê·€)
                    document.body.classList.remove('complete-view');

                    // 2. ìƒˆë¡œìš´ UI ìˆ¨ê¸°ê¸°
                    completeTextArea.style.opacity = '0';
                    completeButtonArea.style.opacity = '0';
                    setTimeout(() => {
                        completeTextArea.style.display = 'none';
                        completeButtonArea.style.display = 'none';
                    }, 500); // fade-out ì‹œê°„

                    // 3. ê¸°ì¡´ UI ë‹¤ì‹œ í‘œì‹œ
                    headerArea.style.opacity = '1';
                    descriptionBox.style.opacity = '1';
                    buttonArea.style.opacity = '1';

                    // 4. ë“œë˜ê·¸ ê¸°ëŠ¥ ë‹¤ì‹œ í™œì„±í™”
                    flowerElements.forEach(item => {
                        item.style.pointerEvents = 'auto';
                        item.style.cursor = 'grab';
                    });
                });
            }

            // ğŸŒŸ 6. WRITE LETTER ë²„íŠ¼ ê¸°ëŠ¥: ìº¡ì²˜, Blob URL ì €ì¥, í˜ì´ì§€ ì´ë™ ğŸŒŸ
if(writeLetterButton) {
    writeLetterButton.addEventListener('click', () => {
        
        writeLetterButton.textContent = "ìº¡ì²˜ ì¤‘...";
        writeLetterButton.disabled = true;
        
        // 1. ì €ì¥ëœ ê½ƒë‹¤ë°œ ë°ì´í„° ë¡œë“œ (ê½ƒì˜ ìœ„ì¹˜, í¬ê¸° ì •ë³´)
        const dataString = sessionStorage.getItem('completedBouquetData');
        if (!dataString) {
            alert("ê½ƒë‹¤ë°œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ ìº¡ì²˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            writeLetterButton.textContent = "ERROR";
            writeLetterButton.disabled = false;
            return;
        }
        const bouquetData = JSON.parse(dataString);

        // 2. ì„ì‹œ ìº¡ì²˜ ì»¨í…Œì´ë„ˆ ìƒì„± ë° í™”ë©´ ë°–ìœ¼ë¡œ ë°°ì¹˜ (ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„)
        const tempCaptureDiv = document.createElement('div');
        Object.assign(tempCaptureDiv.style, {
            position: 'fixed',
            top: '-9999px',
            left: '0',
            width: '55vw',       // ì›ë³¸ #bouquet-containerì˜ í¬ê¸° ê¸°ì¤€
            height: '90vh',      // ì›ë³¸ #bouquet-containerì˜ í¬ê¸° ê¸°ì¤€
            overflow: 'hidden',
            backgroundColor: 'transparent',
            zIndex: '-1',
            transform: 'none'    // ëª¨ë“  CSS ë³€í™˜ ì œê±°
        });

        // 3. í¬ì¥ì§€ ì´ë¯¸ì§€ì™€ ê½ƒ ì˜ì—­ DOMì„ ì„ì‹œ ì»¨í…Œì´ë„ˆì— ì¬êµ¬ì„±
        const bouquetBack = document.createElement('img');
        bouquetBack.src = "bouquetbb.png"; 
        Object.assign(bouquetBack.style, {
            position: "absolute", bottom: "1vh", left: "45%", transform: "translateX(-50%)",
            width: "auto", height: '98%', zIndex: "1"
        });

        const tempFlowerArea = document.createElement('div');
        Object.assign(tempFlowerArea.style, {
            position: "absolute", top: "6%", left: "7%", width: "74%", height: "60%",
            zIndex: "2", 
            // ğŸš¨ ìº¡ì²˜ ì‹œ ì˜ë¦¼ ë°©ì§€: clip-pathë¥¼ ì œê±°í•©ë‹ˆë‹¤. ğŸš¨
            clipPath: "none", 
            // í¬ì¥ì§€ì— ê°€ë ¤ì§€ëŠ” ê²ƒì€ bouquetFrontê°€ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.
        });

        const bouquetFront = document.createElement('img');
        bouquetFront.src = "bouquetff.png"; 
        Object.assign(bouquetFront.style, {
            position: "absolute", bottom: "1vh", left: "45%", transform: "translateX(-50%)",
            width: "auto", height: "70%", zIndex: "3"
        });

        tempCaptureDiv.appendChild(bouquetBack);
        tempCaptureDiv.appendChild(tempFlowerArea);
        tempCaptureDiv.appendChild(bouquetFront);

        // 4. ì €ì¥ëœ ë°ì´í„°ë¡œ ê½ƒ ìš”ì†Œë¥¼ ì¬ë°°ì¹˜
        bouquetData.forEach(flower => {
            const flowerDiv = document.createElement('img');
            flowerDiv.src = flower.imgSrc;
            flowerDiv.alt = flower.alt;
            
            // ì €ì¥ëœ ìŠ¤íƒ€ì¼ ê°’ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬
            Object.assign(flowerDiv.style, {
                position: "absolute",
                width: flower.width, // ì˜ˆ: "10vw"
                height: "auto",
                zIndex: flower.zIndex,
                transform: flower.transform, // ì˜ˆ: translate(Xpx, Ypx) rotate(0deg) scaleX(1)
                filter: "drop-shadow(5px 5px 5px rgba(0, 0, 0, 0.6))"
            });
            tempFlowerArea.appendChild(flowerDiv);
        });

        document.body.appendChild(tempCaptureDiv);

        // 5. ìº¡ì²˜ ì‹¤í–‰ (ì•ˆì •í™”ë¥¼ ìœ„í•´ 100ms ëŒ€ê¸°)
        setTimeout(() => {
            
            html2canvas(tempCaptureDiv, {
                useCORS: true,
                backgroundColor: null,
                width: tempCaptureDiv.offsetWidth,
                height: tempCaptureDiv.offsetHeight,
            }).then(canvas => {
                
                // 6. Blobìœ¼ë¡œ ë³€í™˜ ë° URL ì €ì¥
                canvas.toBlob(function(blob) {
                    const finalBouquetBlobURL = URL.createObjectURL(blob);
                    sessionStorage.setItem('finalBouquetImageURL', finalBouquetBlobURL);
                    
                    // 7. ì„ì‹œ ì»¨í…Œì´ë„ˆ ì œê±°
                    document.body.removeChild(tempCaptureDiv);
                    
                    // 8. ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
                    sessionStorage.removeItem('capturedLetterImageURL'); 
                    sessionStorage.removeItem('senderName'); 
                    sessionStorage.removeItem('recipientName'); 
                    
                    writeLetterButton.textContent = "WRITE LETTER";
                    writeLetterButton.disabled = false;
                    window.location.href = 'delivery.html';

                }, 'image/png'); 
                
            }).catch(err => {
                console.error("ê½ƒë‹¤ë°œ ìº¡ì²˜ ì‹¤íŒ¨:", err);
                document.body.removeChild(tempCaptureDiv);
                writeLetterButton.textContent = "ERROR";
                writeLetterButton.disabled = false;
                alert("ê½ƒë‹¤ë°œ ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.");
            });
        }, 100); 
    });
}


            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê½ƒ ìƒì„±
             setTimeout(generateRandomFlowers, 250);

        });
    </script>
</body>
</html>
