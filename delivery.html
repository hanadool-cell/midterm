<!DOCTYPE html>

<html lang="ko">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Digital Bouquet - ì „ë‹¬í•˜ê¸°</title>

    <script>

    // Adobe Typekit ë¡œë” (ê¸°ì¡´ ìœ ì§€)

    (function(d) {

      var config = {

        kitId: 'bno4gef',

        scriptTimeout: 3000,

        async: true

      },

      h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)

    })(document);

    </script>

    <link rel="stylesheet" href="https://use.typekit.net/bno4gef.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>



    <style>

        /* --- ê¸°ë³¸ ë° ë¹„ë””ì˜¤ ìŠ¤íƒ€ì¼ --- */

        body {

            background-color: #000;

            color: white;

            height: 100vh;

            margin: 0;

            font-family: "pretendard", sans-serif;

            overflow: hidden;

            position: relative;

        }



        #video-background {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            object-fit: cover;

            z-index: 0;

        }



        /* --- UI ë° ì¤‘ì•™ ì •ë ¬ --- */

        #delivery-ui-wrapper {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: flex-end;

            z-index: 10;

        }

        

        /* --- ê½ƒë‹¤ë°œ ë“œë˜ê·¸ ê°€ëŠ¥ ìš”ì†Œ (ì´ˆê¸° ìœ„ì¹˜ ìˆ˜ì •) --- */

        #draggable-bouquet {

            position: absolute;

            width: 40vw;

            height: auto;

            max-height: 80vh;

            cursor: grab;

            user-select: none;

            /* [ìˆ˜ì •] ì™„ì „ í•˜ë‹¨ìœ¼ë¡œ ë°°ì¹˜ */

            left: 52%; /* ì¤‘ì•™ ì •ë ¬ */

            bottom: -20vh; /* ì™„ì „ í•˜ë‹¨ */

            transform: translateX(-50%); /* ì¤‘ì•™ ì •ë ¬ ë³´ì • */

            z-index: 20;

            transition: opacity 1.5s ease-out; 

        }

        

        /* --- íŒŒë™ ì• ë‹ˆë©”ì´ì…˜ (Grab Signal) --- */

        @keyframes pulse {

            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }

            70% { box-shadow: 0 0 0 60px rgba(255, 255, 255, 0); }

            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }

        }



        .pulse-target {

            border-radius: 50%;

            transition: all 0.3s;

            pointer-events: none;

            position: absolute;

            top: 50%;

            left: 50%;

            transform: translate(-50%, -50%);

            width: 30px;

            height: 30px;

            background-color: rgba(255, 255, 255, 0.8);

            animation: pulse 2s infinite;

            z-index: 99;

        }

        

        /* [ìˆ˜ì •] ì´ˆê¸° ì‹ í˜¸ ìœ„ì¹˜: ê½ƒë‹¤ë°œê³¼ ë™ì¼í•˜ê²Œ ì™„ì „ í•˜ë‹¨ */

        #initial-signal {

            bottom: 5vh; /* ê½ƒë‹¤ë°œì´ ìˆëŠ” ì˜ì—­ì— ë°°ì¹˜ */

            

            top: auto !important; /* JSì˜ top ì„¤ì •ì„ ë¬´ì‹œ */

        }



        /* ì „ë‹¬ ëª©í‘œ ì§€ì  íŒŒë™ ìœ„ì¹˜ ì¡°ì • */

        #target-signal {

             bottom: 60% !important; /* ì „ë‹¬ ëª©í‘œ ì§€ì  (í™”ë©´ ì¤‘ì•™ ìƒë‹¨ ê·¼ì²˜) */

             top: auto !important;

        }



        /* --- ì•ˆë‚´ ë©”ì‹œì§€ ë°•ìŠ¤ --- */

        #guide-message {

            position: fixed;

            top: 50%;

            left: 50%;

            transform: translate(-50%, -50%);

            padding: 2vw 4vw;

            background-color: rgba(0, 0, 0, 0.7);

            color: #cdff45;

            font-size: 1.5vw;

            text-align: center;

            z-index: 50;

            opacity: 0;

            transition: opacity 0.5s ease-in-out ;

            pointer-events: none;

        }



        #guide-message.show {

            opacity: 1;

        }

        

        /* --- ì „ë‹¬ ì™„ë£Œ í™”ë©´ --- */

        #completion-overlay {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0, 0, 0, 0.9);

            display: none;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            z-index: 100;

        }



        #completion-box {

            padding: 4vw 6vw;

            background-color: rgba(0, 0, 0, 0.9); 

            border: 1px solid #cdff45;

            color: #cdff45;

            text-align: center;

            font-family: "argent-pixel-cf", sans-serif;

            font-size: 3vw;

            box-shadow: 0 0 30px rgba(205, 255, 69, 0.5);

            display: flex; 

            flex-direction: column; 

            align-items: center; 

        }



        #go-main-button {

            padding: 1vw 5vw;

            font-size: 2vw;

            font-family: "argent-pixel-cf", sans-serif;

            font-weight: 900;

            font-style: regular;

            color: #cdff45;

            background: rgba(0, 0, 0, 0.434);

            border: #cdff45 1px solid ;

            cursor: pointer;

            transition: background 0.3s, color 0.3s;

            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);

            margin-top: 4vw;;

        }

        #go-main-button:hover {

            background: #cdff45;

            color: rgb(0, 0, 0);

        }

        

    </style>

    

</head>

<body>

    <video id="video-background" preload="auto" poster="walk_poster.jpg" playsinline muted>

        <source src="walk.mp4" type="video/mp4"> 

        Your browser does not support the video tag.

    </video>

    

    <div id="delivery-ui-wrapper">

        <img id="draggable-bouquet" src="" alt="ë“œë˜ê·¸ ê°€ëŠ¥í•œ ê½ƒë‹¤ë°œ">

        

        <div id="initial-signal" class="pulse-target"></div>

        

        <div id="target-signal" class="pulse-target" style="opacity: 0; display: none;"></div>

        

    </div>



    <div id="guide-message"></div>

    

    <div id="completion-overlay">

        <div id="completion-box">

            BOUQUET IS DELIVERED!

            <button id="go-main-button">GO MAIN</button>

        </div>

    </div>



<script>

    document.addEventListener('DOMContentLoaded', () => {

        const video = document.getElementById('video-background');

        const bouquetImg = document.getElementById('draggable-bouquet');

        const initialSignal = document.getElementById('initial-signal');

        const targetSignal = document.getElementById('target-signal');

        const guideMessage = document.getElementById('guide-message');

        const completionOverlay = document.getElementById('completion-overlay');

        const goMainButton = document.getElementById('go-main-button');

        

        let isDragging = false;

        let videoEnded = false; // ì˜ìƒ ì¢…ë£Œ ì—¬ë¶€ (ì „ë‹¬ ëª¨ë“œ)

        let initialGuideCompleted = false; // ì´ˆê¸° ì•ˆë‚´ ì™„ë£Œ ì—¬ë¶€

        

        // ğŸŒŸ Blob URL ë³€ìˆ˜ ì„ ì–¸ ë° ë°ì´í„° ë¡œë“œ ğŸŒŸ

        const finalBouquetBlobURL = sessionStorage.getItem('finalBouquetImageURL');

        

        if (!finalBouquetBlobURL) {

            alert("ê½ƒë‹¤ë°œ ì´ë¯¸ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.");

            window.location.href = "love.html"; // ì ì ˆí•œ ì‹œì‘ í˜ì´ì§€ë¡œ ë³€ê²½

            return;

        }



        bouquetImg.src = finalBouquetBlobURL; 

        

        // ------------------------------------------------------------------

        // [1. ë©”ëª¨ë¦¬ í•´ì œ ë¡œì§ ì¶”ê°€]

        // ------------------------------------------------------------------

        const cleanupBlobURL = () => {

             if (finalBouquetBlobURL) {

                 URL.revokeObjectURL(finalBouquetBlobURL);

                 sessionStorage.removeItem('finalBouquetImageURL');

                 console.log("ê½ƒë‹¤ë°œ Blob URL í•´ì œë¨.");

             }

             const letterBlobURL = sessionStorage.getItem('capturedLetterImageURL');

             if (letterBlobURL) {

                 URL.revokeObjectURL(letterBlobURL);

                 sessionStorage.removeItem('capturedLetterImageURL');

                 console.log("í¸ì§€ì§€ Blob URL í•´ì œë¨.");

             }

        };



        window.addEventListener('unload', cleanupBlobURL);

        

        // [2. ì´ˆê¸° ì„¤ì •]

        // ë¹„ë””ì˜¤ ì´ˆê¸° ìƒíƒœ: ì •ì§€ ìƒíƒœë¥¼ ëª…í™•íˆ í•¨

        video.load(); // ì²« í”„ë ˆì„ì„ ë¡œë“œ

        initialSignal.style.display = 'none';



        // [3. ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜]

        const showGuide = (message, duration, callback) => {

            guideMessage.textContent = message;

            guideMessage.classList.add('show');

            setTimeout(() => {

                guideMessage.classList.remove('show');

                if (callback) {

                    setTimeout(callback, 500); 

                }

            }, duration);

        };

        

        // [4. ë¹„ë””ì˜¤ ë ì´ë²¤íŠ¸]

        video.onended = () => {

            videoEnded = true;

            // ë¹„ë””ì˜¤ ë í”„ë ˆì„ ìœ ì§€

            video.pause(); 

            video.currentTime = video.duration; 

            

            showGuide("ìƒëŒ€ë°© ì•ì— ë„ì°©í–ˆì–´ìš”. ê½ƒë‹¤ë°œì„ ë“œë˜ê·¸í•´ ìƒëŒ€ì—ê²Œ ì „ë‹¬í•´ì£¼ì„¸ìš”!", 3000, () => {

                // ì „ë‹¬ ëª¨ë“œ ì‹œì‘: ê½ƒë‹¤ë°œì„ ëŒì–´ì„œ ì¤‘ì•™ ëª©í‘œ ì§€ì ì— ë†“ë„ë¡ ì•ˆë‚´

                targetSignal.style.display = 'block';

                targetSignal.style.opacity = 1;

            });

        };

        

        // [5. ë“œë˜ê·¸ ë¡œì§]

        let offsetX, offsetY;



        const startDrag = (e) => {

            if (!initialGuideCompleted) return; // ì´ˆê¸° ì•ˆë‚´ê°€ ëë‚˜ì•¼ ë“œë˜ê·¸ ê°€ëŠ¥

            if (isDragging) return; // ì´ë¯¸ ë“œë˜ê·¸ ì¤‘ì´ë©´ ë¬´ì‹œ

            

            isDragging = true;

            bouquetImg.style.cursor = 'grabbing';

            initialSignal.style.display = 'none'; // ì´ˆê¸° ì‹ í˜¸ ì œê±°

            

            const rect = bouquetImg.getBoundingClientRect();

            

            // í„°ì¹˜ ì´ë²¤íŠ¸ ëŒ€ì‘

            const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;

            const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

            

            offsetX = clientX - rect.left;

            offsetY = clientY - rect.top;



            if (!videoEnded) {

                // ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘ (ê½ƒë‹¤ë°œì„ ì¡ëŠ” ìˆœê°„)

                video.play();

                // ë“œë˜ê·¸ ì‹œì‘ ì‹œì ì˜ ìœ„ì¹˜ë¥¼ ì ˆëŒ€ê°’ìœ¼ë¡œ ê³ ì •

                bouquetImg.style.position = 'fixed';

                bouquetImg.style.left = `${clientX - offsetX}px`;

                bouquetImg.style.top = `${clientY - offsetY}px`;

                bouquetImg.style.transform = 'none';

            }

        };



        const doDrag = (e) => {

            if (!isDragging) return;



            e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€ (í„°ì¹˜ í™˜ê²½)



            const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;

            const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;



            let newX = clientX - offsetX;

            let newY = clientY - offsetY;

            

            bouquetImg.style.left = `${newX}px`;

            bouquetImg.style.top = `${newY}px`;

            

            if (videoEnded) {

                // ì „ë‹¬ ëª¨ë“œ: ì¤‘ì•™ ì „ë‹¬ ì§€ì  ë„ë‹¬ í™•ì¸

                const targetCenterX = window.innerWidth / 2;

                // target-signalì˜ CSS bottom: 60%ì— ë§ì¶° yì¶• ëª©í‘œ ì§€ì  ì„¤ì •

                const targetCenterY = window.innerHeight * (1 - 0.6); 

                

                const bouquetCenterX = newX + (bouquetImg.offsetWidth / 2);

                const bouquetCenterY = newY + (bouquetImg.offsetHeight / 2);

                

                const distance = Math.sqrt(

                    Math.pow(bouquetCenterX - targetCenterX, 2) + 

                    Math.pow(bouquetCenterY - targetCenterY, 2)

                );



                // ì¤‘ì•™ ì§€ì (ì•½ 100px ë°˜ê²½)ì— ë„ë‹¬í•˜ë©´ ì™„ë£Œ

                if (distance < 100) {

                    finishDeliverySequence();

                }

            }

        };

        

        const stopDrag = () => {

            if (!isDragging) return;

            isDragging = false;

            bouquetImg.style.cursor = 'grab';



            if (!videoEnded) {

                // ë¹„ë””ì˜¤ ì¼ì‹œ ì •ì§€ (ê½ƒë‹¤ë°œì„ ë†“ëŠ” ìˆœê°„)

                video.pause();

                // ìœ„ì¹˜ ì´ˆê¸°í™”: CSS í•˜ë‹¨ ì¤‘ì•™ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ë„ë¡ ì¬ì„¤ì •

                bouquetImg.style.position = 'absolute';

                bouquetImg.style.left = '50%';

                bouquetImg.style.top = 'auto'; // topì„ autoë¡œ ì„¤ì •í•˜ì—¬ bottomì´ ì ìš©ë˜ê²Œ í•¨

                bouquetImg.style.transform = 'translateX(-50%)'; 

                

                // ì•ˆë‚´ ì‹ í˜¸ê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ í‘œì‹œ

                if (initialSignal.style.display === 'none') {

                    initialSignal.style.display = 'block';

                }

            }

        };

        

        // [6. ìµœì¢… ì „ë‹¬ ì™„ë£Œ ì‹œí€€ìŠ¤]

        const finishDeliverySequence = () => {

            // ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ìš”)

            document.removeEventListener('mousemove', doDrag);

            document.removeEventListener('mouseup', stopDrag);

            document.removeEventListener('touchmove', doDrag);

            document.removeEventListener('touchend', stopDrag);

            

            isDragging = false;

            

            // 1. í˜ì´ë“œ ì•„ì›ƒ ì‹œì‘

            bouquetImg.style.opacity = 0; 

            targetSignal.style.display = 'none';

            guideMessage.classList.remove('show');

            

            // 2. 1.5ì´ˆ í›„ ì™„ë£Œ ì˜¤ë²„ë ˆì´ í‘œì‹œ

            setTimeout(() => {

                completionOverlay.style.display = 'flex';

                // ğŸŒŸ ì „ë‹¬ì´ ì™„ë£Œëœ í›„ì— Blob URL í•´ì œ ğŸŒŸ

                cleanupBlobURL(); 

            }, 1500); 

        };



        // [7. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°]

        bouquetImg.addEventListener('mousedown', startDrag);

        document.addEventListener('mousemove', doDrag);

        document.addEventListener('mouseup', stopDrag);

        

        // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸

        bouquetImg.addEventListener('touchstart', startDrag, { passive: false });

        document.addEventListener('touchmove', doDrag, { passive: false });

        document.addEventListener('touchend', stopDrag);





        // ë²„íŠ¼ ì´ë²¤íŠ¸

        goMainButton.addEventListener('click', () => {

            // ì´ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë©”ì¸ìœ¼ë¡œ ì´ë™

            window.location.href = "index.html";

        });



        

        // [8. ì´ˆê¸° ì•ˆë‚´ ë©”ì‹œì§€]

        setTimeout(() => {

            showGuide("ì € ì•ì— ìƒëŒ€ë°©ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. <br>ê½ƒë‹¤ë°œì„ ê³„ì† í´ë¦­í•œ ìƒíƒœë¡œ ìƒëŒ€ì—ê²Œ ê±¸ì–´ê°€ì„¸ìš”.", 3000, () => {

                initialGuideCompleted = true; // ì´ˆê¸° ì•ˆë‚´ ì™„ë£Œ

                initialSignal.style.display = 'block'; // ì´ˆê¸° ë“œë˜ê·¸ ì‹ í˜¸ í‘œì‹œ

            });

        }, 1000);

    });

</script>

</body>

</html>
